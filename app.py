import json
from pymongo import MongoClient
import requests
from flask import Flask, jsonify, render_template
from flask import request
from flask_restplus import Resource, Api
from flask_restplus import fields
from flask_restplus import inputs
from flask_restplus import reqparse
import re

# Helper Functions
#app = Flask(__name__)
from project import * #import project folder as module (contains __init__.py)
api = Api(app)

@api.route('/exercises', methods=['GET'])
class AllCollections(Resource):
	def get(self):
		# Connect to mongodb mlab
		mongo_port = 27107
		db_name = 'comp4920'
		collection_name = 'exercises'
		mongo_host = "mongodb://admin:admin123@ds331558.mlab.com:31558/comp4920"
		client = MongoClient(host=mongo_host, port=mongo_port)
		db = client[db_name]
		exercises = db[collection_name]

		# Obtain collection
		collection = db.exercises.find()

		output_list = []

		# Abort if collection not found
		if not collection:
			api.abort(404, "There are no collections in the database")

		# For testing, print out all records
		for record in collection:
			#print(record)
			exercise_id = record['id']
			exercise_name = record['exercise']
			description = record['description']
			output_dict = {
				"id": exercise_id,
				"exercise": exercise_name,
				"description": description
			}
			output_list.append(output_dict)
			#print(output_list)

		#return output_list
		return render_template('exercises.html', workout=output_list[:5])
		

	# Method used by developers only. Exercises will not be generated by the user
	# def post(self)

if __name__ == '__main__':    
    app.run(debug=True)